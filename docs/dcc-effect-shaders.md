# Ghi chú về effect shader trong thư mục `editor/assets/effects/util/dcc`

## Mục đích chung
Hai effect `imported-metallic-roughness` và `imported-specular-glossiness` được đóng gói sẵn để engine dùng khi nhập (import) vật liệu từ các phần mềm DCC (Digital Content Creation) như Blender, 3ds Max, Maya, Cinema 4D hoặc pipeline glTF. Chúng ánh xạ các tham số PBR phổ biến của vật liệu được xuất từ các công cụ đó sang mô hình chiếu sáng chuẩn của Cocos Creator, đồng thời cung cấp hai workflow PBR phổ biến: "metallic-roughness" và "specular-glossiness". 【F:editor/assets/effects/util/dcc/imported-metallic-roughness.effect†L3-L78】【F:editor/assets/effects/util/dcc/imported-specular-glossiness.effect†L3-L82】【F:editor/assets/effects/util/dcc/imported-specular-glossiness.effect†L141-L222】

## `imported-metallic-roughness.effect`
* **Cấu trúc kỹ thuật**: định nghĩa hai kỹ thuật `opaque` và `transparent`, mỗi kỹ thuật gồm các pass render-to-scene, forward-add và shadow-caster dùng chung cặp shader `standard-vs`/`standard-fs`. Điều này cho phép cùng một vật liệu hỗ trợ chiếu sáng trực tiếp, cộng dồn ánh sáng bổ sung và đổ bóng. 【F:editor/assets/effects/util/dcc/imported-metallic-roughness.effect†L5-L78】【F:editor/assets/effects/util/dcc/imported-metallic-roughness.effect†L337-L398】
* **Thuộc tính vật liệu**: bộ `properties` mô tả đầy đủ các map/slider chuẩn của workflow metallic-roughness (albedo, roughness, metallic, occlusion, normal, emissive, opacity). Các thuộc tính dùng `editor` metadata để engine dựng UI tương ứng, ví dụ `BaseColor`, `BaseWeight`, phạm vi slider 0-1 hay việc bật tắt các map tùy macros. 【F:editor/assets/effects/util/dcc/imported-metallic-roughness.effect†L9-L29】【F:editor/assets/effects/util/dcc/imported-metallic-roughness.effect†L189-L333】
* **Xử lý shader**: phần `surface-fragment` cung cấp các hàm hook của hệ thống Surfaces nhằm hiệu chỉnh base color, độ trong suốt, normal map, emissive và vector tham số PBR. Các macro `USE_*` cho phép importer bật/tắt theo map thực tế, còn `ALPHA_SOURCE_IS_OPACITY` quyết định cách dịch texture opacity thành alpha. 【F:editor/assets/effects/util/dcc/imported-metallic-roughness.effect†L135-L333】
* **Hỗ trợ importer**: khối `macro-remapping` ánh xạ macro ở UI (HAS_SECOND_UV, USE_TWOSIDE, v.v.) sang macro nội bộ của hệ surface, bảo đảm vật liệu nhập từ DCC dùng đúng kênh UV, chế độ hai mặt hoặc xử lý ánh sáng tương thích. 【F:editor/assets/effects/util/dcc/imported-metallic-roughness.effect†L97-L122】

## `imported-specular-glossiness.effect`
* **Định nghĩa workflow**: tương tự shader trên nhưng tập trung vào workflow specular-glossiness, với bộ thuộc tính xoay quanh diffuse/specular, glossiness hoặc shininess map, transparency và metallic phụ trợ (được bật khi file nguồn đã xuất sẵn kênh metallic). 【F:editor/assets/effects/util/dcc/imported-specular-glossiness.effect†L5-L82】
* **Phân biệt nguồn DCC**: macro `DCC_APP_NAME` có giá trị từ 0–5 để phân biệt Blender, 3ds Max, Maya, Cinema4D, glTF..., từ đó các hàm `convertShininessExponent` và `getSpecularIntensityFromRoughness` chuyển đổi phạm vi thông số shininess/roughness đặc thù từng ứng dụng. Đây là lý do effect nằm trong thư mục `dcc`: nó bọc các quy tắc hoán đổi dữ liệu vật liệu giữa các công cụ DCC và engine. 【F:editor/assets/effects/util/dcc/imported-specular-glossiness.effect†L141-L222】
* **Ghép nối dữ liệu**: Hàm `SurfacesFragmentModifySharedData` thực hiện hợp nhất diffuse, specular, glossiness, metallic và occlusion để sinh ra `SurfacesMaterialData` chuẩn của hệ PBR, bao gồm cả bước suy ra metallic từ diffuse/specular nếu dữ liệu nhập không cung cấp trực tiếp. Điều này cho phép vật liệu specular-glossiness vẫn chạy trên pipeline PBR duy nhất của engine. 【F:editor/assets/effects/util/dcc/imported-specular-glossiness.effect†L291-L367】

## Khi nào engine chọn effect này?
Khi importer đọc dữ liệu vật liệu từ file DCC và nhận biết workflow (ví dụ glTF metallic-roughness hay FBX xuất specular-glossiness), engine sẽ gán một trong hai effect trên cho vật liệu mới. Các macro tùy chọn, texture slot và phép chuyển đổi đặc thù phần mềm bảo đảm rằng vật liệu từ công cụ DCC vẫn giữ được ngoại quan khi chuyển sang runtime Cocos Creator. Điều này thể hiện qua hệ macro `USE_*` và `DCC_APP_*` được thiết kế để importer cài đặt tương ứng với dữ liệu đầu vào. 【F:editor/assets/effects/util/dcc/imported-metallic-roughness.effect†L135-L333】【F:editor/assets/effects/util/dcc/imported-specular-glossiness.effect†L141-L367】
